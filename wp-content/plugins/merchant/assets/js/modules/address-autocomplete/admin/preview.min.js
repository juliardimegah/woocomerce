function _regenerator(){var m,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",n=e.toStringTag||"@@toStringTag";function r(e,t,n,r){var o,i,a,c,s,l,u,p,d,t=t&&t.prototype instanceof f?t:f,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,i=n,u=r||[],p=!1,d={p:l=0,n:0,v:m,a:h,f:h.bind(m,4),d:function(e,t){return a=e,c=0,s=m,d.n=t,g}},function(e,t,n){if(1<l)throw TypeError("Generator is already running");for(p&&1===t&&h(t,n),c=t,s=n;(y=c<2?m:s)||!p;){a||(c?c<3?(1<c&&(d.n=-1),h(c,s)):d.n=s:d.v=s);try{if(l=2,a){if(y=a[e=c?e:"next"]){if(!(y=y.call(a,s)))throw TypeError("iterator result is not an object");if(!y.done)return y;s=y.value,c<2&&(c=0)}else 1===c&&(y=a.return)&&y.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+e+"' method"),c=1);a=m}else if((y=(p=d.n<0)?s:o.call(i,d))!==g)break}catch(e){a=m,c=1,s=e}finally{l=1}}return{value:y,done:p}}),!0),t;function h(e,t){for(c=e,s=t,y=0;!p&&l&&!n&&y<u.length;y++){var n,r=u[y],o=d.p,i=r[2];3<e?(n=i===t)&&(s=r[(c=r[4])?5:c=3],r[4]=r[5]=m):r[0]<=o&&((n=e<2&&o<r[1])?(c=0,d.v=t,d.n=r[1]):o<i&&(n=e<3||r[0]>t||i<t)&&(r[4]=e,r[5]=t,d.n=i,c=0))}if(n||1<e)return g;throw p=!0,t}}var g={};function f(){}function o(){}function i(){}var y=Object.getPrototypeOf,e=[][t]?y(y([][t]())):(_regeneratorDefine2(y={},t,function(){return this}),y),a=i.prototype=f.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,_regeneratorDefine2(e,n,"GeneratorFunction")),e.prototype=Object.create(a),e}return _regeneratorDefine2(a,"constructor",o.prototype=i),_regeneratorDefine2(i,"constructor",o),_regeneratorDefine2(i,n,o.displayName="GeneratorFunction"),_regeneratorDefine2(a),_regeneratorDefine2(a,n,"Generator"),_regeneratorDefine2(a,t,function(){return this}),_regeneratorDefine2(a,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:r,m:c}})()}function _regeneratorDefine2(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(_regeneratorDefine2=function(e,t,n,r){function o(t,n){_regeneratorDefine2(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))})(e,t,n,r)}function asyncGeneratorStep(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=c.apply(e,a);function o(e){asyncGeneratorStep(r,t,n,o,i,"next",e)}function i(e){asyncGeneratorStep(r,t,n,o,i,"throw",e)}o(void 0)})}}(n=>{var t,e,r={$apiKeyInput:null,$addressInput:null,placeAutocompleteElement:null,bootstrapScript:null,config:{debug:!1,apiKeyLength:39,retryAttempts:3,retryDelay:1e3,scriptLoadTimeout:5e3},init:function(){var e,t=this;this.$apiKeyInput=n('.merchant-module-page-setting-field[data-id="api_key"] input'),this.$addressInput=n("#merchant-address-autocomplete"),this.$apiKeyInput.length&&this.$addressInput.length?(this.activateAutocompleteIfNeeded(),this.$apiKeyInput.on("input",function(){clearTimeout(e),e=setTimeout(function(){t.activateAutocompleteIfNeeded()},500)}),this.log("Preview autocomplete initialized")):this.handleError("Required DOM elements not found","warning")},activateAutocompleteIfNeeded:function(){var e=this.$apiKeyInput.val();e&&this.validateApiKey(e)?this.loadGoogleMapsScript(e):this.deactivateAutocomplete()},validateApiKey:function(e){return"string"==typeof e&&(e.length!==this.config.apiKeyLength?(this.log("Invalid API key length: ".concat(e.length,", expected: ").concat(this.config.apiKeyLength),"warning"),!1):!!/^[A-Za-z0-9_-]+$/.test(e)||(this.log("API key contains invalid characters","warning"),!1))},loadGoogleMapsScript:function(e){this.deactivateAutocomplete();try{var t;null!=(t=window.google)&&null!=(t=t.maps)&&t.importLibrary?(this.log("Google Maps already loaded, initializing autocomplete"),this.initializeAutocomplete()):(this.bootstrapScript=document.createElement("script"),this.bootstrapScript.textContent=this.getBootstrapLoaderScript(e),this.bootstrapScript.setAttribute("data-merchant-maps-loader","true"),document.head.appendChild(this.bootstrapScript),this.initializeAutocompleteWithTimeout(),this.log("Google Maps script injected"))}catch(e){this.handleError("Failed to load Google Maps script","error",e),this.deactivateAutocomplete()}},getBootstrapLoaderScript:function(e){e=this.sanitizeValue(e);return'\n\t\t\t\t(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({\n\t\t\t\t\tkey: "'.concat(e,'",\n\t\t\t\t\tv: "weekly"\n\t\t\t\t});\n\t\t\t')},initializeAutocompleteWithTimeout:function(){var t=this,n=setTimeout(function(){t.handleError("Google Maps script load timeout","error"),t.deactivateAutocomplete()},this.config.scriptLoadTimeout);this.initializeAutocomplete().then(function(){clearTimeout(n)}).catch(function(e){clearTimeout(n),t.handleError("Failed to initialize autocomplete","error",e),t.deactivateAutocomplete()})},initializeAutocomplete:(e=_asyncToGenerator(_regenerator().m(function e(){var t,n,r,o=this,i=arguments;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=0<i.length&&void 0!==i[0]?i[0]:1,e.p=1,e.n=2,this.waitForGoogleMaps();case 2:return e.n=3,google.maps.importLibrary("places");case 3:n=e.v,n=n.PlaceAutocompleteElement,this.placeAutocompleteElement=new n,this.$addressInput.attr("class")&&(this.placeAutocompleteElement.className=this.$addressInput.attr("class")),this.$addressInput.hide(),this.$addressInput.after(this.placeAutocompleteElement),this.placeAutocompleteElement.addEventListener("gmp-select",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){return _regenerator().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,o.handlePlaceSelection(t.placePrediction);case 1:return e.a(2)}},e)}));return function(e){return t.apply(this,arguments)}})()),this.log("Autocomplete element initialized successfully"),e.n=7;break;case 4:if(e.p=4,r=e.v,t<this.config.retryAttempts)return this.log("Retry attempt ".concat(t+1," to initialize autocomplete")),e.n=5,this.delay(this.config.retryDelay);e.n=6;break;case 5:return e.a(2,this.initializeAutocomplete(t+1));case 6:throw r;case 7:return e.a(2)}},e,this,[[1,4]])})),function(){return e.apply(this,arguments)}),waitForGoogleMaps:function(){return new Promise(function(t,n){function r(){var e;null!=(e=window.google)&&null!=(e=e.maps)&&e.importLibrary?t():50<=o?n(new Error("Google Maps failed to load")):(o++,setTimeout(r,100))}var o=0;r()})},handlePlaceSelection:(t=_asyncToGenerator(_regenerator().m(function e(t){var n,r;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.setLoadingState(!0),n=t.toPlace(),e.n=1,n.fetchFields({fields:["displayName","formattedAddress","location","addressComponents"]});case 1:r=this.sanitizeValue(n.formattedAddress||""),this.$addressInput.val(r),this.$addressInput.trigger("change"),this.log("Selected place:",n.toJSON()),e.n=3;break;case 2:e.p=2,r=e.v,this.handleError("Error fetching place details","error",r);case 3:return e.p=3,this.setLoadingState(!1),e.f(3);case 4:return e.a(2)}},e,this,[[0,2,3,4]])})),function(e){return t.apply(this,arguments)}),setLoadingState:function(e){this.placeAutocompleteElement&&(e?this.placeAutocompleteElement.classList.add("loading"):this.placeAutocompleteElement.classList.remove("loading"))},sanitizeValue:function(e){return"string"!=typeof e?"":n("<div>").text(e).html()},deactivateAutocomplete:function(){if(this.placeAutocompleteElement){try{this.placeAutocompleteElement.remove()}catch(e){this.log("Error removing autocomplete element","warning")}this.placeAutocompleteElement=null}this.cleanupGoogleMapsScripts(),this.resetAddressField(),this.log("Autocomplete deactivated")},cleanupGoogleMapsScripts:function(){try{var e;null!=(e=window.google)&&e.maps&&delete window.google,document.querySelectorAll("script").forEach(function(e){(e.src.includes("googleapis.com/maps")||e.src.includes("maps.gstatic.com")||e.textContent.includes("importLibrary")||e.getAttribute("data-merchant-maps-loader"))&&e.remove()}),this.bootstrapScript=null,this.log("Google Maps scripts cleaned up")}catch(e){this.handleError("Error cleaning up scripts","warning",e)}},resetAddressField:function(){this.$addressInput&&this.$addressInput.length&&(this.$addressInput.val(""),this.$addressInput.show(),this.$addressInput.removeClass("loading"))},handleError:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"error",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=n?"".concat(e,": ").concat(n.message):e;"critical"===t||"error"===t?console.error("[AddressAutocompletePreview] ".concat(e),n):console.warn("[AddressAutocompletePreview] ".concat(e)),this.log(e,t)},log:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"log";this.config.debug&&"undefined"!=typeof console&&(t=(new Date).toISOString(),console[n]("[AddressAutocompletePreview ".concat(t,"]"),e))},delay:function(t){return new Promise(function(e){return setTimeout(e,t)})}};n(document).ready(function(){r.init()}),n(window).on("beforeunload",function(){r.deactivateAutocomplete()}),r.config.debug&&(window.addressAutocompletePreview=r)})(jQuery);